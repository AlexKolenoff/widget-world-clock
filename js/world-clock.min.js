var RiseVision=RiseVision||{};RiseVision.WorldClock={};RiseVision.WorldClock.Controller={};
RiseVision.WorldClock.Controller=function(){this.rsW=prefs.getInt("rsW");this.rsH=prefs.getInt("rsH");this.useLocalTime=prefs.getBool("use-local-time");this.timeZone=prefs.getString("time-zone");this.showTitle=prefs.getBool("show-title");this.placement=prefs.getString("placement");this.horizontalAlign=prefs.getString("horizontal-align");this.verticalAlign=prefs.getString("vertical-align");this.clockType=prefs.getString("clock-type");this.frameColor=prefs.getString("frame-color");this.faceColor=prefs.getString("face-color");
this.handColor=prefs.getString("hand-color");this.frameWidth=prefs.getInt("frame-width");this.hourTickWidth=prefs.getInt("hour-tick-width");this.minuteTickWidth=prefs.getInt("minute-tick-width");this.handWidth=prefs.getInt("hand-width");this.showSecondHand=prefs.getBool("show-second-hand");this.secondHandColor=prefs.getString("second-hand-color");this.secondHandWidth=prefs.getInt("second-hand-width");this.format=prefs.getString("format")};
RiseVision.WorldClock.Controller.prototype.getAdditionalParams=function(b,a){"additionalParams"==b&&a&&(document.createElement("style"),a=JSON.parse(a),controller.showTitle&&(controller.titleFont=new RiseVision.Common.Font(a["title-font"],a["title-font-style"],a["title-font-url"],"titleFont"),controller.titleFontSize=a["title-font-size"],controller.titleColor=a["title-color"],controller.titleBold=a["title-bold"],controller.titleItalic=a["title-italic"]),"analog"==controller.clockType?(controller.numbersFont=
new RiseVision.Common.Font(a["numbers-font"],a["numbers-font-style"],a["numbers-font-url"],"numbersFont"),controller.canvasFont="",a["numbers-bold"]&&(controller.canvasFont="bold "),a["numbers-italic"]&&(controller.canvasFont+="italic "),controller.canvasFont+=a["numbers-font-size"]+"px ",controller.canvasFont+=controller.numbersFont.getFontFamily(),controller.numbersColor=a["numbers-color"]):(controller.digitalFont=new RiseVision.Common.Font(a["digital-font"],a["digital-font-style"],a["digital-font-url"],
"digitalFont"),$("#digitalClock").css("font-family",controller.digitalFont.getFontFamily()),a["digital-bold"]&&$("#digitalClock").css("font-weight","bold"),a["digital-italic"]&&$("#digitalClock").css("font-style","italic"),$("#digitalClock").css("color",a["digital-color"])));controller.init()};
RiseVision.WorldClock.Controller.prototype.init=function(){var b,a=$("#analogClock");this.showTitle&&(b=$("<div id='title' class='titleFont'></div>"),b.text(prefs.getString("title")),b.addClass(prefs.getString("clock-type")+" "+this.placement),b.css("padding",prefs.getString("padding")+"px"),b.css("font-family",this.titleFont.getFontFamily()),b.css("font-size",this.titleFontSize+"px").css("color",this.titleColor),this.titleBold&&b.css("font-weight","bold"),this.titleItalic&&b.css("font-style","italic"),
"top"==this.placement||"bottom"==this.placement?(b.addClass("halign"+this.horizontalAlign),"top"==this.placement?$("#container").prepend(b):$("#container").append(b)):(b.addClass("valign"+this.verticalAlign),"middle"==this.verticalAlign&&(b.css("line-height",this.rsH-2*prefs.getInt("padding")+"px"),$("#container").css("text-align","left")),$("#container").prepend(b)));timezoneJS.timezone.zoneFileBasePath="https://s3.amazonaws.com/Common-Production/TimezoneJS/Olson";timezoneJS.timezone.init({async:!1});
"analog"==prefs.getString("clock-type")?(b=document.getElementById("analogClock"),$("#container").width(this.rsW).height(this.rsH),$("#digitalClock").hide(),this.showTitle?"top"==this.placement||"bottom"==this.placement?(this.clockSize=this.rsH-$("#title").outerHeight(),this.clockSize>this.rsW&&(this.clockSize=this.rsW),b.width=this.clockSize,b.height=this.clockSize,$("#container").addClass("haligncenter")):("middle"==this.verticalAlign?(this.clockSize=this.rsW-$("#title").outerWidth(),this.clockSize>
this.rsH&&(this.clockSize=this.rsH),a.addClass("valign"),a.css("margin-top",-this.clockSize/2+"px")):(this.clockSize=this.rsH-$("#title").outerHeight(),this.clockSize>this.rsW&&(this.clockSize=this.rsW),$("#container").addClass("haligncenter")),b.width=this.clockSize,b.height=this.clockSize):(this.rsW>this.rsH?(this.clockSize=this.rsH,$("#container").addClass("haligncenter")):this.rsW<this.rsH?(this.clockSize=this.rsW,a.css("margin-top",this.rsH/2-this.clockSize/2+"px")):this.clockSize=this.rsW,b.width=
this.clockSize,b.height=this.clockSize)):(a.hide(),this.setBodyScale(),this.showTitle?"top"==this.placement||"bottom"==this.placement?$("#digitalClock").css("line-height",this.rsH-$("#title").outerHeight()+"px"):$("#digitalClock").css("line-height",this.rsH+"px"):$("#digitalClock").css("line-height",this.rsH+"px"));readyEvent()};
RiseVision.WorldClock.Controller.prototype.drawAnalog=function(){var b=this,a=document.getElementById("analogClock"),c,d,e;if(a.getContext){a=a.getContext("2d");a.clearRect(0,0,this.clockSize,this.clockSize);a.font=this.canvasFont;a.textBaseline="middle";a.textAlign="center";a.lineWidth=1;a.save();a.strokeStyle=this.frameColor;a.fillStyle=this.faceColor;a.lineWidth=this.frameWidth;a.beginPath();a.arc(this.clockSize/2,this.clockSize/2,this.clockSize/2-this.frameWidth/2,0,2*Math.PI,!0);a.fill();a.stroke();
a.strokeStyle=this.numbersColor;a.fillStyle=this.numbersColor;a.save();a.translate(this.clockSize/2,this.clockSize/2);for(d=1;60>=d;d++)ang=Math.PI/30*d,sang=Math.sin(ang),cang=Math.cos(ang),0==d%5?(a.lineWidth=this.hourTickWidth,sx=sang*this.clockSize/2.9,sy=cang*-this.clockSize/2.9,ex=sang*this.clockSize/2.3,ey=cang*-this.clockSize/2.3,nx=sang*this.clockSize/3.55,ny=cang*-this.clockSize/3.55,a.fillText(d/5,nx,ny)):(a.lineWidth=this.minuteTickWidth,sx=sang*this.clockSize/2.5,sy=cang*this.clockSize/
2.5,ex=sang*this.clockSize/2.3,ey=cang*this.clockSize/2.3),a.beginPath(),a.moveTo(sx,sy),a.lineTo(ex,ey),a.stroke();c=this.useLocalTime?new Date:new timezoneJS.Date(new Date,this.timeZone);d=c.getHours();e=c.getMinutes();c=c.getSeconds();a.strokeStyle=this.handColor;a.lineWidth=this.handWidth;a.save();a.rotate(Math.PI/6*(d+e/60+c/3600));a.beginPath();a.moveTo(0,this.clockSize/30);a.lineTo(0,-this.clockSize/5);a.stroke();a.restore();a.save();a.rotate(Math.PI/30*(e+c/60));a.beginPath();a.moveTo(0,this.clockSize/
15);a.lineTo(0,-this.clockSize/2.5);a.stroke();a.restore();a.save();this.showSecondHand&&(a.rotate(Math.PI/30*c),a.strokeStyle=this.secondHandColor,a.lineWidth=this.secondHandWidth,a.beginPath(),a.moveTo(0,this.clockSize/15),a.lineTo(0,-this.clockSize/2.5),a.stroke());a.restore();a.restore();this.timeoutID=setTimeout(function(){b.drawAnalog()},1E3)}};
RiseVision.WorldClock.Controller.prototype.drawDigital=function(){var b=this,a=" AM",c=this.useLocalTime?new Date:new timezoneJS.Date(new Date,this.timeZone),d=c.getHours(),e=c.getMinutes(),c=c.getSeconds(),f="";12<=d&&(a=" PM");9>=e&&(e="0"+e);9>=c&&(c="0"+c);"12-hour-seconds"==this.format||"12-hour"==this.format?(12<d&&(d-=12),0==d&&(d=12),f="12-hour-seconds"==this.format?d+":"+e+":"+c+a:d+":"+e+a):f="24-hour-seconds"==this.format?d+":"+e+":"+c:d+":"+e;$("#digitalClock").html(f);this.timeoutID=
setTimeout(function(){b.drawDigital()},1E3)};
RiseVision.WorldClock.Controller.prototype.setBodyScale=function(){var b=parseInt($("#digitalClock").css("font-size")),a,c=this.rsH;a="left"!=this.placement&&"right"!=this.placement||"middle"!=this.verticalAlign?this.rsW:this.rsW-$("#title").outerWidth();for("12-hour-seconds"==this.format?$("#digitalClock").html("00:00:00 AM"):"12-hour"==this.format?$("#digitalClock").html("00:00 AM"):"24-hour-seconds"==this.format?$("#digitalClock").html("00:00:00"):$("#digitalClock").html("00:00");document.getElementById("digitalClock").offsetWidth<a&&
document.getElementById("digitalClock").offsetHeight<c;)$("#digitalClock").css("font-size",++b);$("#digitalClock").css("font-size",--b)};RiseVision.WorldClock.Controller.prototype.play=function(){"analog"==prefs.getString("clock-type")?this.drawAnalog():this.drawDigital()};RiseVision.WorldClock.Controller.prototype.pause=function(){clearTimeout(this.timeoutID)};